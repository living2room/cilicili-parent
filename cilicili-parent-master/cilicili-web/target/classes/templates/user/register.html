<!doctype html>

<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org"
	xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">

<script src="/webjars/jquery/3.2.1/dist/jquery.min.js"></script>

<title>用户登录</title>
</head>

<body>
	<h3 align="center">用户注册</h3>
	<h3 style="color: red" th:utext="${info}"></h3>
	<h3 style="color: red" th:utext="${info1}"></h3>
	<h3 style="color: red" th:utext="${info2}"></h3>
	<div id="" align="center">
		<form action="">
			昵称:<input type="text" name="userName" id="userName"
				placeholder="输入昵称"><br> 邮箱<input id="email"
				type="email" name="email" placeholder="填写常用邮箱" /> <br> 密 码:<input
				type="text" name="userPassword" id="userPassword" placeholder="输入密码"><br>

			<input id="checkCode" type="text" name="checkCode"
				placeholder="邮箱验证码" />
			<button id="sendCheckCode" type="button">点击获取</button>
			<br> <input type="button" id="register" value="注册" /><br>
			<a href="#">已有帐号，去登录></a>
		</form>
	</div>
</body>
<script type="text/javascript">
	$("#register").click(function() {
		var inputCheckCode = $("#checkCode").val();
		var userName = $("#userName").val()
		var userPassword = $("#userPassword").val()
		var email = $("#email").val()
		var user = {
			userName : userName,
			userPassword : userPassword,
			email : email
		}
		if (inputCheckCode == checkCode) {
			$.ajax({
				url : "/user/register",
				type : "POST",
				data : user,
				dataType : "json",
				//async : true,
				success : function(data) {
					console.log(data["msg"]);
					if ("1" == data["msg"]) {
						window.location.href = "/user/toLogin";
						alert("注册成功");

					} else if ("-1" == data["msg"]) {
						alert("该邮箱已注册");
						location.href = "/user/toRegister";
					} else {
						alert("该用户名已存在");
						location.href = "/user/toRegister";
					}
				},
				error : function(data) {
					alert(data + "400");
				}
			});
		} else {
			alert("验证码输入错误");
		}
	});

	//验证码
	var checkCode = "";

	$("#sendCheckCode").click(function() {
		console.log("12354")
		var email = $("#email").val();
		if (email == null || email == "") {
			alert("请输入邮箱！！！");
			return false;
		}
		/*           var index = window.open({
		              type:3,
		              content:"邮件发送中..."
		          }); */

		$.ajax({
			url : "/getCheckCode?email=" + email,
			type : "get",
			success : function(text) {
				if (text != null && text != "") {
					/*                         close(index); */
					alert("已发送" + text);
					checkCode = text;
					/*                         countDown(); */
				} else {
					alert("获取失败，请重新获取");
				}
			}
		});
	});

	/*         var maxTime = 60;
	 function countDown(){
	 if (maxTime == 0){
	 checkCode = "";
	 $("#sendCheckCode").removeClass("layui-btn-disabled");
	 $("#sendCheckCode").removeAttr("disabled")
	 $("#sendCheckCode").html("获取验证码");
	 maxTime = 60;
	 }else{
	 $("#sendCheckCode").attr("disabled","disabled");
	 $("#sendCheckCode").addClass("layui-btn-disabled");
	 form.render();
	 $("#sendCheckCode").html(maxTime+"秒后重新获取");
	 maxTime--;
	 setTimeout(countDown,1000);
	 }
	 } */
</script>

</html>