<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport"
	content=" width=device-width, inittial-scale=1,maximum-scale=1" />
<title></title>
<link rel="stylesheet" type="text/css" href="../css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="../css/style.css" />
<script src="../css/bootstrap.css"></script>
<!-- <script src="../js/jquery.js"></script> -->
<script src="/webjars/jquery/3.2.1/dist/jquery.min.js"></script>
</head>

<body>
	<div class="container-fluid">
		<div
			style="height: 950px; width: 1920px; background: url(../img/zhuce.jpg)">

			<div class="top">
				<div class="nav">
					<div class="logo">
						<img src="../img/LOGO01.png">
					</div>
					<div id="box">
						<input type="text" id="box_sousuo" name="search"
							placeholder="请输入关键字">
						<div id="search">搜索</div>
					</div>
					<div class="nav_right">
						<div class="shouye">
							<div class="tubiao">
								<img src="../img/shouye.png">
							</div>
							<div class="nav_text">
								<a href="index.html" style="color: #00b7ee;">首页</a>
							</div>
						</div>
						<div class="shcngchuan">
							<div class="tubiao">
								<img src="../img/shangchuan.png">
							</div>
							<div class="nav_text">
								<a href="#">上传</a>
							</div>
						</div>
						<div class="shcngchuan">
							<div class="tubiao">
								<img src="../img/tuiguang.png">
							</div>
							<div class="nav_text">
								<a href="#">推广</a>
							</div>
						</div>
						<div class="shcngchuan">
							<div class="tubiao">
								<img src="../img/huiyuan.png">
							</div>
							<div class="nav_text">
								<a href="#">会员</a>
							</div>
						</div>
						<div class="shcngchuan">
							<div class="tubiao">
								<img src="../img/yonghu.png">
							</div>
							<div class="nav_text">
								<a href="Login.html">登录</a>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div style="height: 74px;"></div>
			<div class=""
				style="margin-left: 1144px; height: 424px; width: 358px;">
				<!-- <div style="height: 14px;"></div> -->
				<h3 style="text-align: center;">正在创建您的用户</h3>
				<br /> <br />
				<div class="input-group ">
					<span class="input-group-addon"> 昵称</span> <input type="text"
						name="userName" id="userName" class="form-control"
						placeholder="请输入您要注册的昵称">
				</div>
				<br />
				<div class="input-group ">
					<span class="input-group-addon"> 邮箱 </span> <input id="email"
						type="email" name="email" class="form-control"
						placeholder="请输入您的邮箱">
				</div>
				<br />
				<div class="input-group ">
					<input id="checkCode" type="text" name="checkCode"
						class="form-control" placeholder="请输入您的邮箱验证码"> <span
						class="input-group-btn">
						<button id="sendCheckCode" type="button" class="btn"
							style="background: #989898; color: #ffffff;">发送验证码</button>
					</span>
				</div>
				<br /> <br />
				<div class="input-group ">
					<span class="input-group-addon"> 密码 </span> <input type="password"
						name="userPassword" id="userPassword" class="form-control"
						placeholder="请输入您的密码">
				</div>
				<input type="hidden" name="status" id="status" value=1>
				<br />
				<div class="container">
					<button type="button" id="register" class="btn btn-primary"
						style="height: 40px; width: 250px; margin-left: 44px; background: #1266f1; font-size: 16px;">注册</button>
				</div>
				<br />
				<div class="center-block" style="text-align: center">
					已有帐号><a href="/user/toLogin">立即登录</a>
				</div>
			</div>
		</div>
</body>


<script type="text/javascript">
	$("#register").click(function() {
		var inputCheckCode = $("#checkCode").val();
		var userName = $("#userName").val()
		var userPassword = $("#userPassword").val()
		var email = $("#email").val()
		var checkCode = $("#checkCode").val()
		var status = $("#status").val()
		var user = {
			userName : userName,
			userPassword : userPassword,
			email : email,
			status : status
		};
		if (userName == "" || userName == null) {
			$("#userName").focus();
			$("#userName").css("color", "red");
			$("#userName").html("请输入邮箱");
			return false;
		} else if (email == "" || email == null) {
			$("#email").focus();
			$("#email").css("color", "red");
			$("#email").html("请输入邮箱");
			return false;
		}  else if (userPassword == "" || userPassword == null) {
			$("#userPassword").focus();
			$("#userPassword").css("color", "red");
			$("#userPassword").html("请输入密码");
			return false;
		} else if (checkCode == "" || checkCode == null) {
			$("#checkCode").focus();
			$("#checkCode").css("color", "red");
			$("#checkCode").html("请输入验证码");
			return false;
		}

		if (inputCheckCode == checkCode) {
			$.ajax({
				url : "/user/register",
				type : "POST",
				data : user,
				dataType : "json",
				//async : true,
				success : function(data) {
					console.log(data["msg"]);
					if ("1" == data["msg"]) {
						window.location.href = "/user/toLogin";
						alert("注册成功");

					} else if ("-1" == data["msg"]) {
						alert("该邮箱已注册");
						location.href = "/user/toRegister";
					} else {
						alert("该用户名已存在");
						location.href = "/user/toRegister";
					}
				},
				error : function(data) {
					alert(data + "400");
				}
			});
		} else {
			alert("验证码输入错误");
		}
	});

	//验证码
	var checkCode = "";

	$("#sendCheckCode").click(function() {
		var email = $("#email").val();
		if (email == null || email == "") {
			alert("请输入邮箱！！！");
			return false;
		}
		/*           var index = window.open({
		              type:3,
		              content:"邮件发送中..."
		          }); */

		$.ajax({
			url : "/getCheckCode?email=" + email,
			type : "get",
			success : function(text) {
				if (text != null && text != "") {
					checkCode = text;
				    countDown();
				} else {
					alert("获取失败，请重新获取");
				}
			}
		});
	});

	/*         var maxTime = 60;
	 function countDown(){
	 if (maxTime == 0){
	 checkCode = "";
	 $("#sendCheckCode").removeClass("layui-btn-disabled");
	 $("#sendCheckCode").removeAttr("disabled")
	 $("#sendCheckCode").html("获取验证码");
	 maxTime = 60;
	 }else{
	 $("#sendCheckCode").attr("disabled","disabled");
	 $("#sendCheckCode").addClass("layui-btn-disabled");
	 form.render();
	 $("#sendCheckCode").html(maxTime+"秒后重新获取");
	 maxTime--;
	 setTimeout(countDown,1000);
	 }
	 } */

	 var maxTime = 60;
		function countDown() {
			if (maxTime == 0) {
				checkCode = "";
				$("#sendCheckCode").prop('disabled', false);

				$("#sendCheckCode").text("获取验证码");
				maxTime = 60;
				return;
			} else {
				$("#sendCheckCode").prop('disabled', true);
				$("#sendCheckCode").text(maxTime + "秒后重新获取");
				maxTime--;
			}
				setTimeout(function(){countDown()}, 1000);
		}
</script>

</html>
