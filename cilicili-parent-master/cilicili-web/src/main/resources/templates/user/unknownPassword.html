<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="../css/style.css"/>
		<script src="/webjars/jquery/3.2.1/dist/jquery.min.js"></script>
	</head>
	
	<body>
		<div class="top">
			<div class="nav">
				<div class="logo"><img src="../img/LOGO01.png" ></div>
				<div id="box">
					<input type="text" id="box_sousuo" name="search" placeholder="请输入关键字">
					<div id="search">搜索</div> 
				</div>
				<div class="nav_right">
					<div class="shouye">
						<div class="tubiao"><img src="../img/shouye.png" ></div>
						<div class="nav_text"><a href="index.html"  style="color: #00b7ee;">首页</a></div>
					</div>
					<div class="shcngchuan">
						<div class="tubiao"><img src="../img/shangchuan.png" ></div>
						<div class="nav_text"><a href="#">上传</a></div>
					</div>
					<div class="shcngchuan">
						<div class="tubiao"><img src="img/tuiguang.png" ></div>
						<div class="nav_text"><a href="#">推广</a></div>
					</div>
					<div class="shcngchuan">
						<div class="tubiao"><img src="img/huiyuan.png" ></div>
						<div class="nav_text"><a href="#">会员</a></div>
					</div>
					<div class="shcngchuan">
						<div class="tubiao"><img src="../img/yonghu.png" ></div>
						<div class="nav_text"><a href="Login.html">登录</a></div>
					</div>
				</div>
			</div>
		</div>
		<div class="password01_top_img"></div>
		<div class="password01_nav">
			<div class="password01_nav_text">
				<a href="Login.html">登录</a>&nbsp;>&nbsp;忘记密码
			</div>
		</div>
		<div class="password01_tubiao"></div>
		<div class="input-group " style="margin-left: 780px;">
			<input id="email" type="email" name="email" class="form-control" style="width: 360px;" placeholder="请输入您的邮箱号">
		</div>
		<br />
		<div class="input-group " style="margin-left: 780px;width: 360px;">
			<input id="checkCode" type="text" name="checkCode"
						class="form-control" placeholder="请输入您的邮箱验证码"> <span
						class="input-group-btn">
						<button id="sendCheckCode" type="button" class="btn"
							style="background: #989898; color: #ffffff;">获取验证码</button>
					</span>
		</div>
		<br />
		<br />
		<button type="button" id="ok" class="btn btn-primary" style="height: 40px;width: 300px;background: #00a1d6;font-size: 16px;margin-left: 810px;border: none;">验证邮箱</button>
		
		
		
	</body>
	
	<script type="text/javascript">
	$("#ok").click(function() {
		var inputCheckCode = $("#checkCode").val();
		var email = $("#email").val();
		if (inputCheckCode == checkCode) {
	
			//var txt=document.getElementById("email").value;
			
			//window.location.href = "/user/wangjimima?email="+email;			
			 $.ajax({
				url : "/user/verification",
				type : "POST",
				data : {
					"email" : $("#email").val(),
				},
				dataType : "json",
				success : function(data) {
					if ("1" == data["msg"]) {
						window.location.href = "/user/wangjimima?email="+email;

					} else {
						alert("该邮箱没有注册，请确认您的邮箱");
						//location.href = "/user/toRegister";
					}
				},
				error : function(data) {
					alert(data + "400");
				}
			});		 
		} else {
			alert("验证码输入错误");
		}
	});

	//验证码
	var checkCode = "";

	$("#sendCheckCode").click(function() {
		var email = $("#email").val();
		if (email == null || email == "") {
			alert("请输入邮箱！！！");
			return false;
		}		
		/*var index = window.open({
		      type:3,
		      content:"邮件发送中..."
		        }); */
		$.ajax({
			url : "/getCheckCode?email=" + email,
			type : "get",
			success : function(text) {
				if (text != null && text != "") {
					/*                         close(index); */
					//alert("已发送" + text);
					checkCode = text;
					countDown();
				} else {
					alert("获取失败，请重新获取");
				}
			}
		});
	});

	var maxTime = 60;
	function countDown() {
		if (maxTime == 0) {
			checkCode = "";
			//$("#sendCheckCode").removeClass("layui-btn-disabled");
			$("#sendCheckCode").prop('disabled', false);

			$("#sendCheckCode").text("获取验证码");
			maxTime = 60;
			return;
		} else {
			$("#sendCheckCode").prop('disabled', true);
			//$("#sendCheckCode").addClass("layui-btn-disabled");
			//form.render();
			$("#sendCheckCode").text(maxTime + "秒后重新获取");
			maxTime--;
			//setTimeout(countDown, 1000);
		}
			setTimeout(function(){countDown()}, 1000);
	}
</script>
	
</html>
